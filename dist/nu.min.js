/*! nu 2014-03-03 */
!function(a){"use strict";var b=/\.([\w\d]+)$/i,c=/([^\\\/]+)$/,d=function(a){var b=["",""];return function(c){if(c){var d=c.split(a);return d?d.splice(0,2):b}return b}},e=d(b),f=d(c),g=function(a){return f(a)[1]},h={id:function(b){b=a.extend({pool:"0123456789abcdefghiklmnopqrstuvwxyz",size:8},b);for(var c="",d=0;d<b.size;d++)c+=b.pool[Math.floor(Math.random()*b.pool.length)];return c}},i={move:function(a,b,c){for(var d=0;d<c.length;d++)a.attr(c[d],b.attr(c[d])),b.removeAttr(c[d]);return a}},j=function(a){return"undefined"!=typeof a&&null!==a},k=function(b,c){var d=function(b,c){var d=0,e=!1,f=a.noop,g={async:function(){return e=!0,f(),h}},h=this.next=function(a){for(;d<b.length;)if(a=b[d++].call(g,a),e)return e=!1,this;return c(a),this};this.isAsync=function(){return e},this.onAsync=function(a){return f=a,this}};return new d(b,c)},l=a.module("nu.list",[]);l.directive("nuList",[function(){return{template:'<div class="nu list"></div>',restrict:"EACM",replace:!0,controller:["$scope","$element","$attrs",function(b,c){this.$render=a.noop,this.$filter=a.noop,this.$link=a.noop,this.$indexOf=a.noop,this.$formatters=[],this.$parsers=[];var d=this,e=function(a){var b=d.$render(a);b.data("src",a),d.$link(b)};this.$indexOf=function(b){for(var c=0;c<d.$src.length;c++)if(a.equals(b,d.$src[c]))return c;return-1},this.$add=function(a){a&&d.$src.push(a)},this.$remove=function(a){d.$src.splice(d.$indexOf(a),1)},this.$empty=function(){c.empty()},this.$draw=function(){d.$empty(),a.forEach(d.$src,function(a){j(a)&&e(a)})}}],link:function(a,b,c,d){var e=c[c.nuList?"nuList":"src"];a.$watchCollection(e,function(a){d.$src=a?a:[],d.$draw()})}}}]),l.directive("nuListType",[function(){var b={img:a.element('<span class="item thumb"><img></img></span>'),txt:a.element('<span class="item"></span>')},c={img:function(a){return function(b){a.removeClass("async").find("img").attr("src",b)}},txt:function(a){return function(b){a.removeClass("async").text(b)}}};return{restrict:"A",require:"nuList",link:function(a,d,e,f){var g,h;e.$observe("nuListType",function(a){var d="img"==a;g=c[d?"img":"txt"],h=b[d?"img":"txt"]}),f.$render=function(a){var b=h.clone();return k(f.$formatters,g(b)).onAsync(function(){b.addClass("async")}).next(a),f.$render.append(b),b},f.$render.append=function(a){d.append(a)}}}}]),l.directive("nuListRemovable",[function(){return{restrict:"A",require:"nuList",link:function(b,c,d,e){var f,g=function(c){var d=a.element(c.currentTarget);e.$remove(d.data("src")),b.$digest()};e.$link=function(a){f!==!1&&a.addClass("remove").on("click",g)};var h=function(){var a=c.find("span");return f?void a.addClass("remove").on("click",g):void a.removeClass("remove").off("click")};d.$observe("nuListRemovable",function(a){f="false"===a?!1:!0,h()})}}}]),l.directive("nuListAddable",[function(){var b={img:function(b,c,d,e){var f=a.element('<label class="buffer img"><input type="file"></label>'),g=f.find("input");return g.on("change",function(a){for(var c=0;c<a.currentTarget.files.length;c++)e.$add(a.currentTarget.files[c]),b.$digest()}),d.$observe("multiple",function(b){a.isDefined(b)&&b?g.attr("multiple",""):g.removeAttr("multiple")}),f.doFocus=function(a){a.srcElement===c[0]&&f[0].click()},f},txt:function(b,c,d,e){var f=a.element('<span contenteditable="true" class="buffer">&nbsp;</span>');return f.on("keydown",function(a){var c=a.which||a.keyCode;if(13===c){var d=this.innerHTML.replace("&nbsp;","").trim();this.innerHTML="",a.preventDefault(),""!==d&&d&&(e.$add(d),b.$digest())}}).on("focus",function(){this.innerHTML=this.innerHTML.replace("&nbsp;","")}).on("blur",function(){""===this.innerHTML&&(this.innerHTML="&nbsp;")}),f.doFocus=function(a){a.stopPropagation(),f[0].focus()},f}};return{restrict:"A",require:"nuList",link:function(c,d,e,f){var g,h,i=d[0],j=f.$add;f.$add=function(a){k(f.$parsers,j).next(a)};var l=f.$empty,m=function(){for(;i.firstChild!=i.lastChild;)a.element(i.firstChild).remove()},n=f.$render.append,o=function(a){i.insertBefore(a[0],g[0])},p=function(){this.done(this.result)},q=function(a){if(a.name&&a.type&&a.type.match(/image.*/)){var b=new FileReader;b.done=this.async(),b.onload=p,b.readAsDataURL(a)}return a},r=function(){if(d.off("mouseup"),g){if(!h&&g[0].parentNode===d[0])return d[0].removeChild(g[0]),f.$empty=l,void(f.$render.append=n);d.append(g),f.$empty=m,f.$render.append=o,d.on("mouseup",g.doFocus)}};e.$observe("nuListAddable",function(a){h="false"!==a?!0:!1,r()}),e.$observe("nuListType",function(a){var h="img"==a,i=b[h?"img":"txt"];g&&(g[0].parentNode===d[0]&&g.remove(),g.unbind()),g=i(c,d,e,f),r(),h&&f.$formatters.unshift(q)})}}}]),l.directive("nuListTypeFilter",[function(){return{restrict:"A",require:"nuList",link:function(a,b,c,d){var e;d.$parsers.unshift(function(a){return!j(e)||a.type.match(e)?a:void 0}),c.$observe("nuListTypeFilter",function(a){e=new RegExp(a)})}}}]);var m=a.module("nu.pb",[]);m.directive("nuPressButton",[function(){var b='<div class="nu button press"><input class="src" type="checkbox" autocomplete="off" style="display:none;"><label icon="Off"></label><label icon="On"></label></div>';return{template:b,restrict:"EACM",replace:!0,require:"?ngModel",compile:function(b,c){var d=c.id,e=b.find("input"),f=b.find("label");d?b.removeAttr("id"):d=h.id(),i.move(e,b,["type","name","checked"]).attr("id",d),f.attr("for",d);var g=function(b,c,d,g){d.$observe("iconOn",function(b){a.element(f[0]).attr("class",(d.icon?d.icon:"")+(b?" "+b:""))}),d.$observe("iconOff",function(b){a.element(f[1]).attr("class",(d.icon?d.icon:"")+(b?" "+b:""))}),d.$observe("disabled",function(b){a.isDefined(b)&&"false"!==b?e.attr("disabled",b):e.removeAttr("disabled")});var h=function(b){return a.isDefined(d.value)&&b===d.value||b===!0};g&&(g.$formatters.unshift(h),g.$parsers.unshift(function(a){return d.value?a?d.value:d.valueOff:a}),g.$isEmpty=function(a){return a!==d.value},g.$render=function(){e[0].checked=g.$viewValue},e.on("change",function(a){var c=this.checked;a.stopPropagation(),("radio"!==this.type||c)&&b.$apply(function(){g.$setViewValue(c)})}),(b[d.ngModel]||e[0].defaultChecked)&&(g.$setViewValue(h(b[d.ngModel])||e[0].defaultChecked&&e[0].checked),g.$render()))};return g}}}]);var n=a.module("nu.switch",[]);n.directive("nuSwitch",[function(){var b='<div class="nu switch"><input class="src" type="checkbox" autocomplete="off"><label class="label"></label></div>';return{template:b,restrict:"EACM",replace:!0,require:"?ngModel",compile:function(b,c){var d=c.id,e=b.find("input"),f=b.find("label");d?b.removeAttr("id"):d=h.id(),i.move(e,b,["type","name","checked"]).attr("id",d),f.attr("for",d),c.$observe("on",function(a){f.text(a?a:"On")}),c.$observe("off",function(a){f.attr("label-off",a?a:"Off")}),c.$observe("disabled",function(b){a.isDefined(b)&&"false"!==b?e.attr("disabled",b):e.removeAttr("disabled")});var g=function(b,c,d,f){var g=function(b){return a.isDefined(d.value)&&b===d.value||b===!0};f&&(f.$formatters.push(g),f.$parsers.push(function(a){return d.value?a?d.value:d.valueOff:a}),f.$isEmpty=function(a){return a!==d.value},f.$render=function(){e[0].checked=f.$viewValue},e.on("change",function(a){a.stopPropagation();var c=this.checked;("radio"!==this.type||c)&&(f.$setViewValue(c),b.$digest())}),(b[d.ngModel]||e[0].defaultChecked)&&(f.$setViewValue(g(b[d.ngModel])||e[0].defaultChecked&&e[0].checked),f.$render()))};return g}}}]);var o=a.module("nu.file.chooser",[]);o.directive("nuFileChooser",[function(){var b='<label class="nu file chooser" style="position: relative;"><input type="file"/><span></span><a class="remove"></a></label>';return{template:b,restrict:"EACM",replace:!0,require:"?ngModel",compile:function(b){var c=b.find("input"),d=b.find("span"),f=b.find("a"),h=function(a,c,d){b.attr("ext",a),b.attr("mime",c),b.attr("state",d)},i=function(b,i,j,k){var l=function(b){if(a.isDefined(b)){var c,d,f;a.isDefined(b.name)?(d=b.type,f=b.name):f=b;var i=e(f);return c=(i.length>1?i[1]:i[0]).toLowerCase(),h(c,d,"selected"),g(f)}return b};k.$formatters.unshift(l),k.$render=function(){d.html(k.$viewValue)},f.on("click",function(){d.html(""),h("","","","select"),b.$apply(function(){k.$setViewValue(void 0)})}),c.on("change",function(a){a.currentTarget.files.length>0&&b.$apply(function(){k.$setViewValue(a.currentTarget.files[0]),k.$viewValue=l(k.$viewValue),k.$render()})})};return i}}}]);var p=function(){var a=arguments;return function(){for(var b=0;b<a.length;b++)a[b].apply(null,arguments)}},q=a.module("nu.gallery",[]);q.directive("nuGallery",[function(){return{template:'<div class="nu gallery"><a class="arrow right"></a><a class="arrow left"></a></div>',restrict:"EACM",replace:!0,require:"ngModel",link:function(b,c,d,e){var f=c[0];e.baseIndex=e.baseIndex||2;var g=function(){return a.forEach(arguments,function(b){a.element(f.children[b]).toggleClass("active")}),arguments[arguments.length-1]},h=[function(){e.index=g(e.index,e.index<f.children.length-1?e.index+1:e.baseIndex)},function(){e.index=g(e.index,e.index>e.baseIndex?e.index-1:f.children.length-1)}];a.forEach(c.find("a"),function(b,c){a.element(b).on("click",h[c])}),e.$render=p(e.$render,function(){e.index=2,a.forEach(e.$viewValue,function(b){c.append(a.element("<img/>").attr("src",b.src||b))}),a.element(c.find("img")[0]).addClass("active")})}}}]),q.directive("nuGallerySlideBar",[function(){return{restrict:"A",replace:!0,require:"ngModel",link:function(a,b,c,d){d.$render=p(d.$render,function(){})}}}])}(angular);