/*! nu 2014-02-23 */
!function(a){"use strict";a.nu={random:{id:function(a){a=angular.extend({pool:"0123456789abcdefghiklmnopqrstuvwxyz",size:8},a);for(var b="",c=0;c<a.size;c++)b+=a.pool[Math.floor(Math.random()*a.pool.length)];return b}},attr:{move:function(a,b,c){for(var d=0;d<c.length;d++)a.attr(c[d],b.attr(c[d])),b.removeAttr(c[d]);return a}},"switch":function(a,b,c){return b&&c?a?b:c:a},invoke:function(a){var b=Array.prototype.slice.call(arguments,1);if(angular.isFunction(a)){var c=a.apply(this,b);if(nu.isDefinedAndNotNull(c))return c}return 1==b.length?b[0]:b},isDefinedAndNotNull:function(a){return"undefined"!=typeof a&&null!==a},pipeLine:function(a,b){var c=function(a,b){var c=0,d=!1,e=angular.noop,f={async:function(){return d=!0,e(),g}},g=this.next=function(e){for(;c<a.length;)if(e=a[c++].call(f,e),d)return this.isAsync=!1,this;return b(e),this};this.isAsync=function(){return d},this.onAsync=function(a){return e=a,this}};return new c(a,b)}}}(this),function(a,b){"use strict";var c=a.module("nu.list",[]);c.directive("nuList",["$parse",function(c){return{template:'<div class="nu list"></div>',restrict:"EACM",replace:!0,controller:["$scope","$element","$attrs",function(d,e,f){this.$render=a.noop,this.$filter=a.noop,this.$link=a.noop,this.$srcVar=f[f.nuList?"nuList":"src"],this.$src=c(this.$srcVar)(d),this.$indexOf=a.noop;var g=this,h=function(a){var b=g.$render(a);b.data("src",a),g.$link(b)};this.$indexOf=function(b){for(var c=0;c<g.$src.length;c++)if(a.equals(b,g.$src[c]))return c;return-1},this.$add=function(a){a&&g.$src.push(a)},this.$remove=function(a){g.$src.splice(g.$indexOf(a),1)},this.$empty=function(){e.empty()},this.$draw=function(){g.$empty(),a.forEach(g.$src,function(a){b.isDefinedAndNotNull(a)&&h(a)})}}],link:function(a,b,c,d){a.$watchCollection(d.$srcVar,d.$draw)}}}]),c.directive("nuListType",[function(){var c={img:a.element('<span class="item thumb"><img></img></span>'),txt:a.element('<span class="item"></span>')},d={img:function(a){return function(b){a.removeClass("async").find("img").attr("src",b)}},txt:function(a){return function(b){a.removeClass("async").text(b)}}};return{restrict:"A",require:"nuList",link:function(a,e,f,g){var h,i;g.$formatters=[],f.$observe("nuListType",function(a){var b="img"==a;h=d[b?"img":"txt"],i=c[b?"img":"txt"]}),g.$render=function(a){var c=i.clone();return b.pipeLine(g.$formatters,h(c)).onAsync(function(){c.addClass("async")}).next(a),g.$render.append(c),c},g.$render.append=function(a){e.append(a)}}}}]),c.directive("nuListRemovable",["$parse",function(b){return{restrict:"A",require:"nuList",link:function(c,d,e,f){var g,h=function(b){var c=a.element(b.currentTarget);f.$remove(c.data("src")),c.remove()};f.$link=function(a){g!==!1&&a.addClass("remove").on("click",h)};var i=function(){var a=d.find("span");return g===!1?void a.removeClass("remove").off("click"):void a.addClass("remove").on("click",h)};e.$observe("nuListRemovable",function(a){var d;d&&d.deregister(),"false"===a?g=!1:(d=c.$watch(a,function(a){g=a,i()}),g=b(a)(c)),i()})}}}]),c.directive("nuListAddable",["$parse",function(c){var d={img:function(b,c,d,e){var f=a.element('<label class="buffer img"><input type="file"></label>'),g=f.find("input");return g.on("change",function(a){for(var c=0;c<a.currentTarget.files.length;c++)e.$add(a.currentTarget.files[c]),b.$digest()}),d.$observe("multiple",function(b){a.isDefined(b)?g.attr("multiple",""):g.removeAttr("multiple")}),f.doFocus=function(a){a.srcElement===c[0]&&f[0].click()},f},txt:function(b,c,d,e){var f=a.element('<span contenteditable="true" class="buffer">&nbsp;</span>');return f.on("keydown",function(a){var c=a.which||a.keyCode;if(13===c){var d=this.innerHTML.replace("&nbsp;","").trim();this.innerHTML="",a.preventDefault(),""!==d&&d&&(e.$add(d),b.$digest())}}).on("focus",function(){this.innerHTML=this.innerHTML.replace("&nbsp;","")}).on("blur",function(){""===this.innerHTML&&(this.innerHTML="&nbsp;")}),f.doFocus=function(a){a.stopPropagation(),f[0].focus()},f}};return{restrict:"A",require:"nuList",link:function(e,f,g,h){var i,j,k=f[0],l=h.$add;h.$parsers=[],h.$add=function(a){b.pipeLine(h.$parsers,l).next(a)};var m=h.$empty,n=function(){for(;k.firstChild!=k.lastChild;)a.element(k.firstChild).remove()},o=h.$render.append,p=function(a){k.insertBefore(a[0],i[0])},q=function(){this.done(this.result)},r=function(a){if(a.name&&a.type&&a.type.match(/image.*/)){var b=new FileReader;b.done=this.async(),b.onload=q,b.readAsDataURL(a)}return a},s=function(){if(f.off("mouseup"),i){if(j===!1&&i[0].parentNode===f[0])return f[0].removeChild(i[0]),h.$empty=m,void(h.$render.append=o);f.append(i),h.$empty=n,h.$render.append=p,f.on("mouseup",i.doFocus)}};g.$observe("nuListAddable",function(a){var b;b&&b.deregister(),"false"===a?j=!1:(b=e.$watch(a,function(a){j=a,s()}),j=c(a)(e)),s()}),g.$observe("nuListType",function(a){var b="img"==a,c=d[b?"img":"txt"];i&&(i[0].parentNode===f[0]&&i.remove(),i.unbind()),i=c(e,f,g,h),s(),b&&h.$formatters.push(r)})}}}]),c.directive("nuListTypeFilter",[function(){return{restrict:"A",require:"nuList",link:function(b,c,d,e){var f;e.$parsers.push(function(b){return!a.isDefinedAndNotNull(f)||b.type.match(f)?b:void 0}),d.$observe("nuListTypeFilter",function(a){f=new RegExp(a)})}}}])}(angular,nu),function(a,b){"use strict";var c=a.module("nu.pb",[]);c.directive("nuPressButton",[function(){var c='<div class="nu button press"><input class="src" type="checkbox" autocomplete="off" style="display:none;"><label icon="Off"></label><label icon="On"></label></div>';return{template:c,restrict:"EACM",replace:!0,require:"?ngModel",compile:function(c,d){var e=d.id,f=c.find("input"),g=c.find("label");e?c.removeAttr("id"):e=b.random.id(),b.attr.move(f,c,["type","name","checked"]).attr("id",e),g.attr("for",e);var h=function(b,c,d,e){d.$observe("iconOn",function(b){a.element(g[0]).attr("class",(d.icon?d.icon:"")+(b?" "+b:""))}),d.$observe("iconOff",function(b){a.element(g[1]).attr("class",(d.icon?d.icon:"")+(b?" "+b:""))}),e&&(e.$formatters.push(function(b){return a.isDefined(d.value)&&b===d.value||b===!0}),e.$parsers.push(function(a){return d.value?a?d.value:d.valueOff:a}),e.$isEmpty=function(a){return a!==d.value},e.$render=function(){f[0].checked=e.$viewValue},f.on("change",function(a){var c=this.checked;a.stopPropagation(),("radio"!==this.type||c)&&b.$apply(function(){e.$setViewValue(c)})}),a.isDefined(b[d.ngModel])?e.$setViewValue(b[d.ngModel]):f[0].defaultChecked&&e.$setViewValue(f[0].checked))};return h}}}])}(angular,nu),function(a,b){"use strict";var c=a.module("nu.switch",[]);c.directive("nuSwitch",[function(){var c='<div class="nu switch"><input class="src" type="checkbox" autocomplete="off"><label class="label"></label></div>';return{template:c,restrict:"EACM",replace:!0,require:"?ngModel",compile:function(c,d){var e=d.id,f=c.find("input"),g=c.find("label");e?c.removeAttr("id"):e=b.random.id(),b.attr.move(f,c,["type","name","checked"]).attr("id",e),g.attr("for",e),d.$observe("on",function(a){g.text(a?a:"On")}),d.$observe("off",function(a){g.attr("label-off",a?a:"Off")});var h=function(b,c,d,e){e&&(e.$formatters.push(function(b){return a.isDefined(d.value)&&b===d.value||b===!0}),e.$parsers.push(function(a){return d.value?a?d.value:d.valueOff:a}),e.$isEmpty=function(a){return a!==d.value},e.$render=function(){f[0].checked=e.$viewValue},f.on("change",function(a){a.stopPropagation();var c=this.checked;("radio"!==this.type||c)&&(e.$setViewValue(c),b.$digest())}),a.isDefined(b[d.ngModel])?e.$setViewValue(b[d.ngModel]):f[0].defaultChecked&&e.$setViewValue(f[0].checked))};return h}}}])}(angular,nu),function(a){"use strict";var b=a.module("nu.file.chooser",[]),c=/\.([\w\d]+)$/i,d=/([^\\\/]+)$/,e=function(a){var b=["",""];return function(c){if(c){var d=c.split(a);return d?d.splice(0,2):b}return b}},f=e(c),g=e(d),h=function(a){return g(a)[1]};b.directive("nuFileChooser",["$parse",function(b){var c='<label class="nu file chooser" style="position: relative;"><input type="file"/>{{path}}<a ng-click="clear()" class="remove"></a></label>';return{template:c,restrict:"EACM",replace:!0,scope:{},controller:["$scope","$element","$attrs",function(c,d,e){this.$guess_type=null;var g=this,i=function(a){return function(b){c.path!==b&&(g.$toSrc&&(b=g.$toSrc(b)),a(c.$parent,b))}};this.$put_src=a.noop,this.$onSelection=a.noop,this.$onClear=a.noop,this.$toPath=function(a){return a&&a.name?a.name:a},this.$toSrc=null,e.$observe("src",function(e){g.$put_src=a.noop;var j="",k="select";if(e){var l=b(e);c.path=h(g.$toPath(l(c.$parent))),l.assign&&(g.$put_src=i(l.assign)),c.path&&""!==c.path.trim()&&(j=f(c.path).pop(),k="selected")}d.attr("ext",j),d.attr("state",k)})}],compile:function(a){var b=a.find("input"),c=function(b,c,d){a.attr("ext",b),a.attr("mime",c),a.attr("state",d)},d=function(a,d,e,g){var h=function(b){var d="",e="",h=null,i="select";b.target.files.length>0&&(h=b.target.files[0],d=f(h.name)[1].toLowerCase(),e=h.type,g.$guess_type&&(e=g.$guess_type.call(h,e,h.name,d)),i="selected"),a.$apply(function(a){a.path=h?h.name:"",g.$put_src(h)}),c(d,e,i)};b.on("change",h),a.clear=function(){a.path="",g.$put_src(null),c("","","selected")}};return d}}}])}(angular);