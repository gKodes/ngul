/*! nu 2014-04-26 */
!function(a){"use strict";function b(b,c,d,e,f,g){var j=d.id,k=c.find("input"),l=c.find("label"),n=d.ngTrueValue,o=d.ngFalseValue;if(e=e||w,j?c.removeAttr("id"):j=i.id(),h.attribute(k,c,["type","name","checked"]).attr("id",j),l.attr("for",j),(!e.$isEmpty(m(n)?n:!0)||e.isNull)&&(e.$isEmpty=function(a){return a!==n},e.$formatters.push(function(a){return n?a===n:a}),e.$parsers.push(function(a){return n?a?n:o:a})),c.off("click"),k.off("click"),e.$render=function(){k[0].checked=e.$viewValue},k[0].defaultChecked&&k[0].checked&&e.$setViewValue(!0),!e.isNull&&a.isDefined(g)){var p;m(g)?(g===n&&(p=!0),g===o&&(p=!1)):p=g,p&&(e.$setViewValue(p),e.$render())}k.on("change",function(a){var c=this.checked;a.stopPropagation(),("radio"!==this.type||c)&&(e.$setViewValue(c),e.isNull||b.$digest()),f.trigger("change",{target:d.name,value:e.$modelValue})}),d.$observe("disabled",function(b){a.isDefined(b)&&"false"!==b?k.attr("disabled",b):k.removeAttr("disabled")})}var c="ng-pristine",d="ng-dirty",e=/\.([\w\d]+)$/i,f=/([^\\\/]+)$/,g=function(a){var b=["",""];return function(c){if(c){var d=c.split(a);return d?d.splice(0,2):b}return b}},h=(g(e),g(f),{}),i={},j={},k=a.noop,l=(a.copy,a.equals,a.forEach),m=a.isString,n=(a.isElement,a.isFunction),o=a.isUndefined,p=a.extend,q=a.$$minErr("nu"),r=function(a){return m(a)?a.replace(/^\s+|\s+$/g,""):""},s=function(a,b){return m(a)&&m(b)&&0===a.indexOf(b)},t=function(a){if(a&&m(a)){var b=a.toLowerCase();return!("false"===b||"f"===b||"off"===b)}return rawValu===!0};i.defaults={pool:"0123456789abcdefghiklmnopqrstuvwxyz",size:8},i.id=function(a){a=p(i.defaults,a);for(var b="",c=0;c<a.size;c++)b+=a.pool[Math.floor(Math.random()*a.pool.length)];return b},h.attribute=function(a,b,c){for(var d=0;d<c.length;d++)a.attr(c[d],b.attr(c[d])),b.removeAttr(c[d]);return a},j.move=h,j.append={},j.append.text=function(a,b,c){var d=document.createTextNode(b);return a.insertBefore(d,c),d};var u=function(a,b,c,d){var e=a.$$watchers.length,f=b.$render,g=i.id(),h=!1;for(d(a,g),b.$render=function(){h=!0};e--&&(a.$$watchers[e].get!==a.$$watchers[e].exp||(a.$$watchers[e].get(),!h)););return b.$render=f,d(a,c),a.$$watchers[e]},v=function(){var a=function(){this.events={}};return a.prototype.on=function(a,b){this.events[a]||(this.events[a]=[]),this.events[a].push(b)},a.prototype.off=function(a){if(this.events[a]){var b=this.events[a].indexOf;if(-1!==b)return this.events[a].split(b,1)[0]}},a.prototype.trigger=function(a,b){return this.events[a]&&l(this.events[a],function(a){a(b)}),b},a}(l),w={$isEmpty:a.identity,$formatters:[],$parsers:[],$setViewValue:function(a){l(this.$parsers,function(b){a=b(a)}),this.$modelValue=a},isNull:!0},x=a.module("nu.List",[]),y=["$scope","$element","$exceptionHandler","$attrs","$compile","$parse",function(b,e,f,g,h,i){var j=this,l=[],m=e[0],n=m.children,o=parseInt(g.capacity)||10,q=g.nuList||g.src,r=i(q),s=r.assign,t=!1,u=(parseInt(g.min),parseInt(g.max),function(a){return m.insertBefore(a,j.$buffers[0])});this.$dirty=!1,this.$pristine=!0,this.$viewValue=Number.NaN,this.$modelValue=Number.NaN,this.$render=k,this.$name=g.name,this.$buffers=[],this.$defaults=p(b.$new(),{$erase:function(){j.$removeItem(this.item)}}),this.$bufferDefaults=p(b.$new(),{$append:function(a){j.$itemNodeFactory({item:a,$index:j.$viewValue.length}),j.$updateViewValue(j.$viewValue.push(a))},$update:function(b,c){a.element(n[b]).scope().item=c,j.$updateViewValue(j.$viewValue[b]=c)}}),this.$getItems=function(){return Array.prototype.slice.call(n,0)},e.addClass(c),b.$watchCollection(q,function(c){return c?(t||(j.$viewValue=j.$modelValue=c,l=j.$getItems(),j.$render(),a.element(l.splice(o-1)).remove(),a.element(l).css("display","none")),void(t=!1)):s?void s(b,[]):void(j.$viewValue=[])}),this.$itemCompiler=h('<span class="list item erase" ng-click="$erase(item)">{{item}}</span>'),this.$itemNodeFactory=function(b){var c=a.element(l.shift()||j.$itemCompiler(j.$defaults.$new(),function(a){u(a[0])}));return p(c.scope(),b),c.css("display","")},this.$removeItem=function(b){var c=this.$viewValue.indexOf(b);n.length>c&&(j.$viewValue.splice(c,1),a.element(n[c]).css("display","none"),u(n[c]),l.push(n[c])),j.$updateViewValue()},this.$setDirty=function(){j.$pristine=!1,j.$dirty=!0,e.removeClass(c).addClass(d)},this.$setPristine=function(){j.$pristine=!0,j.$dirty=!1,e.removeClass(d).addClass(c)},this.$updateViewValue=function(){j.$pristine&&j.$setDirty(),s&&(t=!0,s(b,j.$viewValue))}}];x.service("listBuffers",function(){var b={};b.txt=function(a,b){a.attr("contenteditable","true"),a.on("keydown",function(a){var c=a.which||a.keyCode;if(13===c){var d=r(this.innerHTML).replace(/<br\/?>/gi,"");this.innerHTML="",a.preventDefault(),d&&b.$apply(function(a){a.$append(d)})}}).html("")},b.file=function(a,b){var c=a.find("input");c.on("change",function(a){var c=a.target.files;c.length>0&&(a.preventDefault(),b.$apply(function(a){for(var b=0;b<c.length;b++)a.$append(c[b])}),this.value="")})},b.default=k,this.compile=function(c,d){var e=a.element(c.replace(/(<\/?)buffer/gi,"$1span")),f=e.attr("type")||"default";return b[f]||(f="default"),b[f](e,d),e},this.type=function(a,c){return c&&(b[a]=c),b[a]}}),x.directive("nuList",["$compile","$parse","listBuffers",function(b,c,d){return{terminal:!0,priority:95,template:'<div class="nu list"></div>',replace:!0,transclude:"element",restrict:"EACM",controller:y,link:function(c,e,f,g,h){var i=h();i.scope().$destroy(),e.data("$nuListController",g);var j=i.find("buffer").remove(),m=r(i.html()),n=e[0].children;if(m&&(s(m,"<")||(m='<span ng-click="$erase(item)">'+m+"</span>"),g.$itemCompiler=b(m)),j.length>0){if(j.find("buffer").length>0)throw q("list","Nested buffers are not allowed");a.forEach(j,function(a){var c=g.$bufferDefaults.$new(),e=b(d.compile(r(a.outerHTML),c))(c).addClass("buffer");g.$buffers.push(e[0])}),e.append(g.$buffers),g.$getItems=function(){return Array.prototype.slice.call(n,0,-j.length)}}var o=function(){g.$removeItem(this.item)};f.$observe("readonly",function(a){g.$defaults.$erase="readonly"===a||"true"===a?k:o,g.$defaults.$erase!==k&&e.attr("readonly","")}),f.$observe("buffer",function(b){var c=a.element(g.$buffers);"false"===b?c.addClass("hidden-buffer"):c.removeClass("hidden-buffer")}),g.$buffers[0]&&e.on("click",function(){g.$buffers[0].focus()}),g.$render=function(){l(g.$viewValue,function(a,b){g.$itemNodeFactory({item:a,$index:b})})}}}}]);var z=a.module("nu.PressButton",["nu.Event"]);z.directive("nuPressButton",["nuEvent","$parse",function(c,d){var e='<div class="nu button press"><input class="src" type="checkbox" autocomplete="off" style="display:none;"><label icon="Off"></label><label icon="On"></label></div>';return{template:e,restrict:"EACM",replace:!0,require:"?ngModel",priority:5,link:function(e,f,g,h){var i=g.nuPressButton||g.icon,j=f.find("label");a.element(j[1]).attr("class",(i?i:"")+(g.on?" "+g.on:"")),a.element(j[0]).attr("class",(i?i:"")+(g.off?" "+g.off:"")),b(e,f,g,h,c(e,g),d(g.ngModel)(e))}}}]);var A=a.module("nu.Switch",["nu.Event"]);A.directive("nuSwitch",["nuEvent","$parse",function(a,c){var d='<div class="nu switch"><input class="src" type="checkbox" autocomplete="off"><label class="label"></label></div>';return{template:d,restrict:"EACM",replace:!0,require:"?ngModel",priority:5,link:function(d,e,f,g){var h=e.find("label");h.text(f.on?f.on:"On"),h.attr("label-off",f.off?f.off:"Off"),b(d,e,f,g,a(d,f),c(f.ngModel)(d))}}}]);var B=a.module("nu.FileChooser",["nu.List","nu.Event"]);B.directive("nuFileChooser",["$compile","listBuffers","nuEvent",function(b,c){var d='<span class="list item" ext="{{ext(item.name || item)}}" ng-click="$erase()">{{item.name || item}}</span>',e='<buffer class="buffer" type="file"><label class="action">Browse<input type="file"></label></buffer>';return{restrict:"AC",require:"nuList",priority:99,link:function(f,g,h,i){var j,k=g[0],l=k.children,m=i.$bufferDefaults.$new(),n=g.hasClass("multiple"),o=a.element(d);if(0===i.$buffers.length?(j=b(c.compile(r(e),m))(m),i.$buffers.push(j[0])):j=a.element(i.$buffers[0]),i.$itemCompiler=b(o),g.append(i.$buffers).addClass("file"),i.$getItems=function(){return Array.prototype.slice.call(l,0,-1)},n)o.addClass("erase"),j.find("input").attr("multiple","multiple");else{g.addClass("single");var p=j.find("input");g.on("click",function(){p[0].click()})}i.$defaults.ext=function(a){if(a){var b=a.split(/\.([\w\d]+)$/i);if(b[1])return b[1].toLowerCase()}};var q=i.$bufferDefaults.$append;i.$bufferDefaults.$append=function(a){n||!n&&0===i.$viewValue.length?q(a):n||i.$bufferDefaults.$update(0,a)}}}}]);var C=a.module("nu.Show",[]);C.directive("nuShow",[function(){var b=function(){return a.element(arguments).toggleClass("active"),arguments[arguments.length-1]};return{template:'<div class="nu show"><a class="navigation right"><div class="arrow right"></div></a><a class="navigation left"><div class="arrow left"></div></a></div>',restrict:"EACM",replace:!0,require:"?ngModel",transclude:!0,link:function(c,d,e,f,g){var h,i,j=[],k=d[0];f&&c.$watchCollection(e.ngModel,function(c){if(a.isArray(c)&&c.length>0){a.forEach(c,function(b,c){h[c]||(h[c]=a.element("<img/>")[0]),h[c]&&h[c].parentNode!==k&&d.append(h[c]),a.element(h[c]).attr("src",b.src||b)});for(var e=c.length;e<h.length;e++)a.element(h[e]).remove();h=d.find("img"),i&&i.parentNode===k||(i=b(h[0]))}else a.element(h).remove()}),g(function(b){a.forEach(b,function(a){a.tagName&&"img"===a.tagName.toLowerCase()&&j.push(a)})}),d.append(j),h=d.find("img"),h&&h.length>0&&(i=b(h[0]));var l=[function(){i=b(i,i.nextSibling||h[0])},function(){i=b(i,"img"===i.previousSibling.tagName.toLowerCase()?i.previousSibling:h[h.length-1])}];a.forEach(d.find("a"),function(b,c){a.element(b).on("click",l[c])})}}}]);var D=a.module("nu.Slider",[]);D.service("_ScrollSize",["$window",function(b){var c,d,e=[],f=a.element('<div style="width:100px;height:100px;overflow:scroll;"><div style="width:200px;height:200px;"></div></div>'),g=function(a,b){var f=a[0],g=b[0];g.offsetWidth>=f.clientWidth&&!a.css("height")&&a.css({maxHeight:g.clientHeight+"px"}),e.push([f,g]),b.css({height:100+c/f.clientHeight*100+"%",width:100+d/f.clientWidth*100+"%"})};a.element(b).on("resize",function(){a.forEach(e,function(a){g.apply(null,a)})}),this.estimate=function(){a.element(b.document.body).append(f),c=f[0].offsetHeight-f[0].clientHeight,d=f[0].offsetWidth-f[0].clientWidth,f.remove()},this.height=function(){return c},this.width=function(){return d},this.hideBars=function(a,b){g(a,b)},this.estimate()}]),D.directive("nuSlider",["_ScrollSize",function(a){var b='<div class="nu slider"><div class="frame" style="overflow:scroll;"></div></div>';return{replace:!0,template:b,restrict:"EACM",transclude:!0,link:function(b,c,d,e,f){var g=c.css("overflow","hidden").find("div");g.append(f()),a.hideBars(c,g)}}}]);var E=a.module("nu.Event",[]);E.service("nuEvent",["$parse",function(a){var b=function(a,b){return function(c){a(b,{$event:c}),b.$digest()}},c=function(c,d){var e=function(c,d,e){e=e||"change click dblclick mousedown mouseup mouseover mouseout mousemove mouseenter mouseleave keydown keyup keypress submit focus blur copy cut paste ",v.call(this),l(d,function(d,f){if(m(f)&&s(f,"nu")){var g=f.substr(2).toLowerCase();-1!==e.indexOf(g+" ")&&this.on(g,b(a(d),c))}},this)};return p(e.prototype,v.prototype),new e(c,d)};return c}]);var F=a.module("nu.Src",[]);F.directive("nuSrc",[function(){return{restrict:"AC",link:function(a,b,c){a.$watch(c.nuSrc,function(a){if(m(a))c.$set("src",a);else if(window.File&&window.FileReader&&a.name&&a.lastModifiedDate){var b=new FileReader;b.readAsDataURL(a),b.onload=function(a){c.$set("src",a.target.result)}}})}}}]);var G=a.module("nu.Wrap",[]),H="ws-view",I="ws-edit";G.run(["$templateCache",function(a){a.put("nu.wrap.default","<div><wrap-view>{{$model$}}</wrap-view><wrap-in></wrap-in></div>")}]);var J=function(a,b){var c=this;a.on("keydown",function(a){var b=a.which||a.keyCode;91===b||b>15&&19>b||b>=37&&40>=b||(c.$toAccept=!0)}),this.$accept=function(){c.$viewValue=a.val(),b.html(c.$viewValue||a.attr("placeholder")),c.$toAccept=!1},this.$reset=function(){a.val(b.html()!==a.attr("placeholder")?b.html():""),c.$toAccept=!1},this.isSimple=!0,this.$valid=!0},K={$template:"nu.wrap.default"},L={$setDirty:k};G.directive("nuWrap",["$templateCache","$parse","$compile","$exceptionHandler","$animate",function(b,e,f,g,h){return{restrict:"AC",require:["?ngModel","^?form","^?wrapset"],priority:10,link:function(i,k,m,p){var q=k[0],r=a.element('<a class="w-view show-view"></a>'),s=p[0]||new J(k,r,x),v=p[1]||L,w=p[2]||K,x=i.$new(!0),y=a.element(b.get(m.nuWrap||w.$template));y.length>1&&(y=a.element("<div></div>").append(y)),y.addClass("nu wrap ws-view"),r.html((y.find("wrap-view").html()||"{{$model$}}").replace("$model$","$viewValue")),y.find("wrap-view").replaceWith(r).length||y.prepend(r);var z=j.append.text(r[0],"");f(y)(x),k.addClass("show-editor w-edit"),q.parentNode.replaceChild(y[0],q),y[0].replaceChild(q,y.find("wrap-in")[0]);var A=function(a){var b=k.attr("placeholder");z.nodeValue=b&&a?b:""};if(s.$toAccept=!1,n(s.$setViewValue)){var B=e(m.ngModel),C=B.assign;x.$valid=s.$valid,x.$error=s.$error,x.$viewValue=s.$viewValue,x.$modelValue=s.$modelValue;var D=u(i,s,B(i),C),E=!1;D&&(D.get=function(a){if(s.$toAccept)return D.last;var b=D.exp(a);return x.$viewValue=s.$viewValue,x.$modelValue=s.$modelValue,A(!s.$viewValue||""===s.$viewValue),b}),s.$setViewValue=function(a){s.$viewValue=a,s.$toAccept=!0,s.$pristine&&(s.$dirty=!0,s.$pristine=!1,h.removeClass(k,c),h.addClass(k,d),v.$setDirty()),l(this.$parsers,function(b){a=b(a)}),x.$viewValue=s.$viewValue,s.$modelValue=x.$modelValue=a,x.$valid=s.$valid},s.$accept=function(){C(i,x.$modelValue),l(s.$viewChangeListeners,function(a){try{a()}catch(b){g(b)}}),s.$toAccept=!1,A(!s.$viewValue||""===s.$viewValue)},s.$reset=function(){s.$toAccept=!1;var a=D.exp(i);a||(s.$viewValue=s.$modelValue=a,k.val("")),x.$viewValue=s.$viewValue,x.$modelValue=s.$modelValue,x.$valid=s.$valid}}A(!k.val()),x.reset=s.$reset,x.accept=s.$accept,x.show=function(a){a!==E&&(s.$toAccept||(x.resetValue=s.$modelValue),y.removeClass(a?H:I).addClass(a?I:H),E=a)};var F=function(a){try{var b=a.which||a.keyCode;(13===b&&!a.ctrlKey||27===b)&&(s.$valid&&27!==b?s.$accept():s.$reset(),i.$digest(),x.show(!1))}catch(c){g(c)}};k.on("keydown",function(a){try{var b=a.which||a.keyCode;13===b&&!a.ctrlKey||27===b?a.preventDefault():s.$toAccept||b>15&&19>b||91===b||x.show(!0)}catch(c){g(c)}}),m.$observe("defaultNav",function(a){k[o(a)||t(a)?"on":"off"]("keyup",F)}),k.on("focus",function(){s.$toAccept||x.show(!0)}),r.on("focus",function(){k.focus()}),k.on("blur",function(){s.$toAccept||x.show(!1)}),r.on("mousedown",function(){x.show(!0),setTimeout(function(){q.focus()},0)})}}}]),G.filter("asterises",function(){return function(a,b){if(a){for(var c="",d=0;d<a.length;d++)c+=b||"•";return c}return a}}),G.directive("wrapset",[function(){return{restrict:"EAC",controller:["$scope","$element","$attrs",function(a,b,c){this.$template=c.wrapset||c.tmpl}]}}]);a.module("nu.Wrap.bs",[]);G.run(["$templateCache",function(a){a.put("nu.wrap.bs.status",'<div class="input-group"><wrap-in></wrap-in><span class="input-group-addon show-editor"><span ng-class="{\'glyphicon-warning-sign\': !$valid, \'glyphicon-ok\': $valid}" class="glyphicon"></span></span></div>'),a.put("nu.wrap.bs.acceptReject",'<div class="input-group"><wrap-in></wrap-in><span class="input-group-addon show-editor" ng-click="$valid && accept(); show(!$valid);"><span class="glyphicon" ng-class="{\'glyphicon-warning-sign\': !$valid, \'glyphicon-ok\': $valid}"></span></span><span class="input-group-addon show-editor" ng-click="reset(); show(false);"><span class="glyphicon glyphicon-remove"></span></span></div>')}]);a.module("nu",["nu.Switch","nu.PressButton","nu.List","nu.FileChooser","nu.Show","nu.Src","nu.Slider","nu.Wrap"])}(angular);