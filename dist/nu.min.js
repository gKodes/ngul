/*! nu 2014-03-17 */
!function(a){"use strict";var b=/\.([\w\d]+)$/i,c=/([^\\\/]+)$/,d=function(a){var b=["",""];return function(c){if(c){var d=c.split(a);return d?d.splice(0,2):b}return b}},e=d(b),f=d(c),g=function(a){return f(a)[1]},h={id:function(b){b=a.extend({pool:"0123456789abcdefghiklmnopqrstuvwxyz",size:8},b);for(var c="",d=0;d<b.size;d++)c+=b.pool[Math.floor(Math.random()*b.pool.length)];return c}},i={move:function(a,b,c){for(var d=0;d<c.length;d++)a.attr(c[d],b.attr(c[d])),b.removeAttr(c[d]);return a}},j=function(a){return"undefined"!=typeof a&&null!==a},k=function(b,c){var d=function(b,c){var d=0,e=!1,f=a.noop,g={async:function(){return e=!0,f(),h}},h=this.next=function(a){for(;d<b.length;)if(a=b[d++].call(g,a),e)return e=!1,this;return c(a),this};this.isAsync=function(){return e},this.onAsync=function(a){return f=a,this}};return new d(b,c)},l=function(){if(!arguments[0]&&2==arguments.length)return arguments[1];var a=arguments;return function(){for(var b=0;b<a.length;b++)a[b].apply(null,arguments)}},m=a.module("nu.list",[]);m.directive("nuList",[function(){return{template:'<div class="nu list"></div>',restrict:"EACM",replace:!0,controller:["$scope","$element","$attrs",function(b,c){this.$render=a.noop,this.$filter=a.noop,this.$link=a.noop,this.$indexOf=a.noop,this.$formatters=[],this.$parsers=[];var d=this,e=function(a){var b=d.$render(a);b.data("src",a),d.$link(b)};this.$indexOf=function(b){for(var c=0;c<d.$src.length;c++)if(a.equals(b,d.$src[c]))return c;return-1},this.$add=function(a){a&&d.$src.push(a)},this.$remove=function(a){d.$src.splice(d.$indexOf(a),1)},this.$empty=function(){c.empty()},this.$draw=function(){d.$empty(),a.forEach(d.$src,function(a){j(a)&&e(a)})}}],link:function(a,b,c,d){var e=c[c.nuList?"nuList":"src"];a.$watchCollection(e,function(a){d.$src=a?a:[],d.$draw()})}}}]),m.directive("nuListType",[function(){var b={img:a.element('<span class="item thumb"><img></img></span>'),txt:a.element('<span class="item"></span>')},c={img:function(a){return function(b){a.removeClass("async").find("img").attr("src",b)}},txt:function(a){return function(b){a.removeClass("async").text(b)}}};return{restrict:"A",require:"nuList",link:function(a,d,e,f){var g,h;e.$observe("nuListType",function(a){var d="img"==a;g=c[d?"img":"txt"],h=b[d?"img":"txt"]}),f.$render=function(a){var b=h.clone();return k(f.$formatters,g(b)).onAsync(function(){b.addClass("async")}).next(a),f.$render.append(b),b},f.$render.append=function(a){d.append(a)}}}}]),m.directive("nuListRemovable",[function(){return{restrict:"A",require:"nuList",link:function(b,c,d,e){var f,g=function(c){var d=a.element(c.currentTarget);e.$remove(d.data("src")),b.$digest()};e.$link=function(a){f!==!1&&a.addClass("remove").on("click",g)};var h=function(){var a=c.find("span");return f?void a.addClass("remove").on("click",g):void a.removeClass("remove").off("click")};d.$observe("nuListRemovable",function(a){f="false"===a?!1:!0,h()})}}}]),m.directive("nuListAddable",[function(){var b={img:function(b,c,d,e){var f=a.element('<label class="buffer img"><input type="file"></label>'),g=f.find("input");return g.on("change",function(a){for(var c=0;c<a.currentTarget.files.length;c++)e.$add(a.currentTarget.files[c]),b.$digest()}),d.$observe("multiple",function(b){a.isDefined(b)&&b?g.attr("multiple",""):g.removeAttr("multiple")}),f.doFocus=function(a){a.srcElement===c[0]&&f[0].click()},f},txt:function(b,c,d,e){var f=a.element('<span contenteditable="true" class="buffer">&nbsp;</span>');return f.on("keydown",function(a){var c=a.which||a.keyCode;if(13===c){var d=this.innerHTML.replace("&nbsp;","").trim();this.innerHTML="",a.preventDefault(),""!==d&&d&&(e.$add(d),b.$digest())}}).on("focus",function(){this.innerHTML=this.innerHTML.replace("&nbsp;","")}).on("blur",function(){""===this.innerHTML&&(this.innerHTML="&nbsp;")}),f.doFocus=function(a){a.stopPropagation(),f[0].focus()},f}};return{restrict:"A",require:"nuList",link:function(c,d,e,f){var g,h,i=d[0],j=f.$add;f.$add=function(a){k(f.$parsers,j).next(a)};var l=f.$empty,m=function(){for(;i.firstChild!=i.lastChild;)a.element(i.firstChild).remove()},n=f.$render.append,o=function(a){i.insertBefore(a[0],g[0])},p=function(){this.done(this.result)},q=function(a){if(a.name&&a.type&&a.type.match(/image.*/)){var b=new FileReader;b.done=this.async(),b.onload=p,b.readAsDataURL(a)}return a},r=function(){if(d.off("mouseup"),g){if(!h&&g[0].parentNode===d[0])return d[0].removeChild(g[0]),f.$empty=l,void(f.$render.append=n);d.append(g),f.$empty=m,f.$render.append=o,d.on("mouseup",g.doFocus)}};e.$observe("nuListAddable",function(a){h="false"!==a?!0:!1,r()}),e.$observe("nuListType",function(a){var h="img"==a,i=b[h?"img":"txt"];g&&(g[0].parentNode===d[0]&&g.remove(),g.unbind()),g=i(c,d,e,f),r(),h&&f.$formatters.unshift(q)})}}}]),m.directive("nuListTypeFilter",[function(){return{restrict:"A",require:"nuList",link:function(a,b,c,d){var e;d.$parsers.unshift(function(a){return!j(e)||a.type.match(e)?a:void 0}),c.$observe("nuListTypeFilter",function(a){e=new RegExp(a)})}}}]);var n=a.module("nu.pb",["nu.event"]);n.directive("nuPressButton",["nuEvent",function(b){var c='<div class="nu button press"><input class="src" type="checkbox" autocomplete="off" style="display:none;"><label icon="Off"></label><label icon="On"></label></div>';return{template:c,restrict:"EACM",replace:!0,require:"?ngModel",link:function(c,d,e,f){var g=e.id,j=d.find("input"),k=d.find("label"),l=b(c,e);g?d.removeAttr("id"):g=h.id(),i.move(j,d,["type","name","checked"]).attr("id",g),k.attr("for",g),e.$observe("iconOn",function(b){a.element(k[0]).attr("class",(e.icon?e.icon:"")+(b?" "+b:""))}),e.$observe("iconOff",function(b){a.element(k[1]).attr("class",(e.icon?e.icon:"")+(b?" "+b:""))}),e.$observe("disabled",function(b){a.isDefined(b)&&"false"!==b?j.attr("disabled",b):j.removeAttr("disabled")});var m=function(b){return a.isDefined(e.value)&&b===e.value||b===!0},n=function(a){return e.value?a?e.value:e.valueOff:a};f&&(f.$formatters.unshift(m),f.$parsers.unshift(n),f.$isEmpty=function(a){return a!==e.value},f.$render=function(){j[0].checked=f.$viewValue},(c[e.ngModel]||j[0].defaultChecked)&&(f.$setViewValue(m(c[e.ngModel])||j[0].defaultChecked&&j[0].checked),f.$render())),l.bind(j,"change",function(a){var b=this.checked;return a.stopPropagation(),f&&("radio"!==this.type||b)&&c.$apply(function(){f.$setViewValue(b)}),{target:e.name,value:n(b)}}),l.bind(k,"focus blur")}}}]);var o=a.module("nu.switch",["nu.event"]);o.directive("nuSwitch",["nuEvent",function(b){var c='<div class="nu switch"><input class="src" type="checkbox" autocomplete="off"><label class="label"></label></div>';return{template:c,restrict:"EACM",replace:!0,require:"?ngModel",link:function(c,d,e,f){var g=e.id,j=d.find("input"),k=d.find("label"),l=b(c,e);g?d.removeAttr("id"):g=h.id(),i.move(j,d,["type","name","checked"]).attr("id",g),k.attr("for",g),e.$observe("on",function(a){k.text(a?a:"On")}),e.$observe("off",function(a){k.attr("label-off",a?a:"Off")}),e.$observe("disabled",function(b){a.isDefined(b)&&"false"!==b?j.attr("disabled",b):j.removeAttr("disabled")});var m=function(b){return a.isDefined(e.value)&&b===e.value||b===!0},n=function(a){return e.value?a?e.value:e.valueOff:a};f&&(f.$formatters.push(m),f.$parsers.push(n),f.$isEmpty=function(a){return a!==e.value},f.$render=function(){j[0].checked=f.$viewValue},(c[e.ngModel]||j[0].defaultChecked)&&(f.$setViewValue(m(c[e.ngModel])||j[0].defaultChecked&&j[0].checked),f.$render())),l.bind(j,"change",function(a){var b=this.checked;return a.stopPropagation(),f&&("radio"!==this.type||b)&&c.$apply(function(){f.$setViewValue(b)}),{target:e.name,value:n(b)}}),l.bind(k,"focus blur")}}}]);var p=a.module("nu.file.chooser",["nu.event"]);p.directive("nuFileChooser",["nuEvent",function(b){var c='<label class="nu file chooser" style="position: relative;"><input type="file"/><span></span><a class="remove"></a></label>';return{template:c,restrict:"EACM",replace:!0,require:"?ngModel",link:function(c,d,f,h){var i=d.find("input"),j=d.find("span"),k=d.find("a"),l=b(c,f),m=function(a,b,c){d.attr("ext",a),d.attr("mime",b),d.attr("state",c)},n=function(b){if(a.isDefined(b)){var c,d,f;a.isDefined(b.name)?(d=b.type,f=b.name):f=b;var h=e(f);return c=(h.length>1?h[1]:h[0]).toLowerCase(),m(c,d,"selected"),g(f)}return b};h&&(h.$formatters.unshift(n),h.$render=function(){j.html(h.$viewValue)},k.on("click",function(){j.html(""),m("","","","select"),c.$apply(function(){h.$setViewValue(void 0)})})),l.bind(i,"change",function(a){if(a.currentTarget.files.length>0){var b=a.currentTarget.files[0];return h&&c.$apply(function(){h.$setViewValue(b)}),j.html(n(b)),{target:f.name,value:a.currentTarget.files}}return{target:f.name}}),l.bind(d,"focus blur")}}}]);var q=a.module("nu.gallery",[]);q.directive("nuGallery",[function(){return{template:'<div class="nu gallery"><a class="arrow right"></a><a class="arrow left"></a></div>',restrict:"EACM",replace:!0,require:"ngModel",link:function(b,c,d,e){var f=c[0];e.baseIndex=e.baseIndex||2;var g=function(){return a.forEach(arguments,function(b){a.element(f.children[b]).toggleClass("active")}),arguments[arguments.length-1]},h=[function(){e.index=g(e.index,e.index<f.children.length-1?e.index+1:e.baseIndex)},function(){e.index=g(e.index,e.index>e.baseIndex?e.index-1:f.children.length-1)}];a.forEach(c.find("a"),function(b,c){a.element(b).on("click",h[c])}),e.$render=l(e.$render,function(){c.find("img").remove(),e.index=2,a.forEach(e.$viewValue,function(b){c.append(a.element("<img/>").attr("src",b.src||b))}),a.element(c.find("img")[0]).addClass("active")})}}}]),q.directive("nuPreviewStrip",[function(){return{restrict:"EACM",replace:!0,require:"nuGallery",link:function(a,b,c,d){d.$render=l(d.$render,function(){})}}}]);var r=a.module("nu.slider",[]);r.service("_ScrollSize",["$window",function(b){var c,d,e=[],f=a.element('<div style="width:100px;height:100px;overflow:scroll;"><div style="width:200px;height:200px;"></div></div>'),g=function(a,b){var f=a[0],g=b[0];g.offsetWidth>=f.clientWidth&&a.css({maxHeight:g.clientHeight+"px"}),e.push([f,g]),b.css({height:100+c/f.clientHeight*100+"%",width:100+d/f.clientWidth*100+"%"})};a.element(b).on("resize",function(){a.forEach(e,function(a){g.apply(null,a)})}),this.estimate=function(){a.element(b.document.body).append(f),c=f[0].offsetHeight-f[0].clientHeight,d=f[0].offsetWidth-f[0].clientWidth,f.remove()},this.height=function(){return c},this.width=function(){return d},this.hideBars=function(a,b){g(a,b)},this.estimate()}]),r.directive("nuSlider",["_ScrollSize",function(a){var b='<div class="nu slider"><div class="frame" style="overflow:scroll;"></div></div>';return{replace:!0,template:b,restrict:"EACM",transclude:!0,link:function(b,c,d,e,f){var g=c.css("overflow","hidden").find("div");f(b,function(b){g.append(b),a.hideBars(c,g)})}}}]);var s=a.module("nu.event",[]);s.service("nuEvent",["$parse",function(b){var c=function(c,d){var e=function(c,d){var e={};a.forEach(d,function(c,d){if(a.isString(d)){var f=d.indexOf("nu");0===f&&(e[d.substr(2).toLowerCase()]=b(c))}});var f=this.trigger=function(a,b){e[a]&&(e[a](c,{$event:b}),c.$digest())};this.bind=function(b,c,d){a.forEach(c.split(" "),function(c){(e[c]||d)&&b.on(c,function(b){f(c,(d||a.identity).call(this,b))})})}};return new e(c,d)};return c}])}(angular,this.nu=this.nu||{});