/*! nu 2014-04-25 */
!function(a){"use strict";var b="ng-pristine",c="ng-dirty",d=/\.([\w\d]+)$/i,e=/([^\\\/]+)$/,f=function(a){var b=["",""];return function(c){if(c){var d=c.split(a);return d?d.splice(0,2):b}return b}},g=(f(d),f(e),{}),h={},i={},j=a.noop,k=(a.copy,a.equals,a.forEach),l=a.isString,m=(a.isElement,a.isFunction),n=a.isUndefined,o=a.extend,p=a.$$minErr("nu"),q=function(a){return l(a)?a.replace(/^\s+|\s+$/g,""):""},r=function(a,b){return l(a)&&l(b)&&0===a.indexOf(b)},s=function(a){if(a&&l(a)){var b=a.toLowerCase();return!("false"===b||"f"===b||"off"===b)}return!1};h.defaults={pool:"0123456789abcdefghiklmnopqrstuvwxyz",size:8},h.id=function(a){a=o(h.defaults,a);for(var b="",c=0;c<a.size;c++)b+=a.pool[Math.floor(Math.random()*a.pool.length)];return b},g.attribute=function(a,b,c){for(var d=0;d<c.length;d++)a.attr(c[d],b.attr(c[d])),b.removeAttr(c[d]);return a},i.move=g,i.append={},i.append.text=function(a,b,c){var d=document.createTextNode(b);return a.insertBefore(d,c),d};var t=function(a,b,c,d){var e=a.$$watchers.length,f=b.$render,g=h.id(),i=!1;for(d(a,g),b.$render=function(){i=!0};e--&&(a.$$watchers[e].get!==a.$$watchers[e].exp||(a.$$watchers[e].get(),!i)););return b.$render=f,d(a,c),a.$$watchers[e]},u=function(){var a=function(){this.events={}};return a.prototype.on=function(a,b){this.events[a]||(this.events[a]=[]),this.events[a].push(b)},a.prototype.off=function(a){if(this.events[a]){var b=this.events[a].indexOf;if(-1!==b)return this.events[a].split(b,1)[0]}},a.prototype.trigger=function(a,b){return this.events[a]&&k(this.events[a],function(a){a(b)}),b},a}(k),v=a.module("nu.List",[]),w=["$scope","$element","$exceptionHandler","$attrs","$compile","$parse",function(d,e,f,g,h,i){var k=this,l=[],m=e[0],n=m.children,p=parseInt(g.capacity)||10,q=g.nuList||g.src,r=i(q),s=r.assign,t=!1,u=(parseInt(g.min),parseInt(g.max),function(a){return m.insertBefore(a,k.$buffers[0])});this.$dirty=!1,this.$pristine=!0,this.$viewValue=Number.NaN,this.$modelValue=Number.NaN,this.$render=j,this.$name=g.name,this.$buffers=[],this.$defaults=o(d.$new(),{$erase:function(){k.$removeItem(this.item)}}),this.$bufferDefaults=o(d.$new(),{$append:function(a){k.$itemNodeFactory({item:a,$index:k.$viewValue.length}),k.$updateViewValue(k.$viewValue.push(a))},$update:function(b,c){a.element(n[b]).scope().item=c,k.$updateViewValue(k.$viewValue[b]=c)}}),this.$getItems=function(){return Array.prototype.slice.call(n,0)},e.addClass(b),d.$watchCollection(q,function(b){return b?(t||(k.$viewValue=k.$modelValue=b,l=k.$getItems(),k.$render(),a.element(l.splice(p-1)).remove(),a.element(l).css("display","none")),void(t=!1)):s?void s(d,[]):void(k.$viewValue=[])}),this.$itemCompiler=h('<span class="list item erase" ng-click="$erase(item)">{{item}}</span>'),this.$itemNodeFactory=function(b){var c=a.element(l.shift()||k.$itemCompiler(k.$defaults.$new(),function(a){u(a[0])}));return o(c.scope(),b),c.css("display","")},this.$removeItem=function(b){var c=this.$viewValue.indexOf(b);n.length>c&&(k.$viewValue.splice(c,1),a.element(n[c]).css("display","none"),u(n[c]),l.push(n[c])),k.$updateViewValue()},this.$setDirty=function(){k.$pristine=!1,k.$dirty=!0,e.removeClass(b).addClass(c)},this.$setPristine=function(){k.$pristine=!0,k.$dirty=!1,e.removeClass(c).addClass(b)},this.$updateViewValue=function(){k.$pristine&&k.$setDirty(),s&&(t=!0,s(d,k.$viewValue))}}];v.service("listBuffers",function(){var b={};b.txt=function(a,b){a.attr("contenteditable","true"),a.on("keydown",function(a){var c=a.which||a.keyCode;if(13===c){var d=q(this.innerHTML).replace(/<br\/?>/gi,"");this.innerHTML="",a.preventDefault(),d&&b.$apply(function(a){a.$append(d)})}}).html("")},b.file=function(a,b){var c=a.find("input");c.on("change",function(a){var c=a.target.files;c.length>0&&(a.preventDefault(),b.$apply(function(a){for(var b=0;b<c.length;b++)a.$append(c[b])}),this.value="")})},b.default=j,this.compile=function(c,d){var e=a.element(c.replace(/(<\/?)buffer/gi,"$1span")),f=e.attr("type")||"default";return b[f]||(f="default"),b[f](e,d),e},this.type=function(a,c){return c&&(b[a]=c),b[a]}}),v.directive("nuList",["$compile","$parse","listBuffers",function(b,c,d){return{terminal:!0,priority:95,template:'<div class="nu list"></div>',replace:!0,transclude:"element",restrict:"EACM",controller:w,link:function(c,e,f,g,h){var i=h();i.scope().$destroy(),e.data("$nuListController",g);var l=i.find("buffer").remove(),m=q(i.html()),n=e[0].children;if(m&&(r(m,"<")||(m='<span ng-click="$erase(item)">'+m+"</span>"),g.$itemCompiler=b(m)),l.length>0){if(l.find("buffer").length>0)throw p("list","Nested buffers are not allowed");a.forEach(l,function(a){var c=g.$bufferDefaults.$new(),e=b(d.compile(q(a.outerHTML),c))(c).addClass("buffer");g.$buffers.push(e[0])}),e.append(g.$buffers),g.$getItems=function(){return Array.prototype.slice.call(n,0,-l.length)}}var o=function(){g.$removeItem(this.item)};f.$observe("readonly",function(a){g.$defaults.$erase="readonly"===a||"true"===a?j:o,g.$defaults.$erase!==j&&e.attr("readonly","")}),f.$observe("buffer",function(b){var c=a.element(g.$buffers);"false"===b?c.addClass("hidden-buffer"):c.removeClass("hidden-buffer")}),g.$render=function(){k(g.$viewValue,function(a,b){g.$itemNodeFactory({item:a,$index:b})})}}}}]);var x=a.module("nu.PressButton",["nu.Event"]);x.directive("nuPressButton",["nuEvent","$parse",function(b,c){var d='<div class="nu button press"><input class="src" type="checkbox" autocomplete="off" style="display:none;"><label icon="Off"></label><label icon="On"></label></div>';return{template:d,restrict:"EACM",replace:!0,require:"?ngModel",priority:5,link:function(d,e,f,i){var j=f.id,k=e.find("input"),l=e.find("label"),m=b(d,f),n=c(f.ngModel);j?e.removeAttr("id"):j=h.id(),g.attribute(k,e,["type","name","checked"]).attr("id",j),l.attr("for",j);var o=f.nuPressButton||f.icon;a.element(l[1]).attr("class",(o?o:"")+(f.on?" "+f.on:"")),a.element(l[0]).attr("class",(o?o:"")+(f.off?" "+f.off:"")),f.$observe("disabled",function(b){a.isDefined(b)&&"false"!==b?k.attr("disabled",b):k.removeAttr("disabled")});var p=function(b){return a.isDefined(f.ngTrueValue)&&b===f.ngTrueValue||b===!0},q=function(a){return f.ngTrueValue?a?f.ngTrueValue:f.ngFalseValue:a};if(i){i.$formatters=[p],i.$parsers=[q],i.$isEmpty=function(a){return a!==f.ngTrueValue},i.$render=function(){k[0].checked=i.$viewValue};var r=n(d);(r||k[0].defaultChecked)&&((p(r)||k[0].defaultChecked&&k[0].checked)&&i.$setViewValue(!0),i.$render()),e.off("click")}k.on("change",function(a){var b=this.checked;a.stopPropagation(),i&&("radio"!==this.type||b)&&d.$apply(function(){i.$setViewValue(b)}),m.trigger("change",{target:f.name,value:q(b)})})}}}]);var y=a.module("nu.Switch",["nu.Event"]);y.directive("nuSwitch",["nuEvent","$parse",function(b,c){var d='<div class="nu switch"><input class="src" type="checkbox" autocomplete="off"><label class="label"></label></div>';return{template:d,restrict:"EACM",replace:!0,require:"?ngModel",priority:5,link:function(d,e,f,i){var j=f.id,k=e.find("input"),l=e.find("label"),m=b(d,f),n=c(f.ngModel);j?e.removeAttr("id"):j=h.id(),g.attribute(k,e,["type","name","checked"]).attr("id",j),l.attr("for",j),f.$observe("on",function(a){l.text(a?a:"On")}),f.$observe("off",function(a){l.attr("label-off",a?a:"Off")}),f.$observe("disabled",function(b){a.isDefined(b)&&"false"!==b?k.attr("disabled",b):k.removeAttr("disabled")});var o=function(b){return a.isDefined(f.ngTrueValue)&&b===f.ngTrueValue||b===!0},p=function(a){return f.ngTrueValue?a?f.ngTrueValue:f.ngFalseValue:a};if(i){i.$formatters=[o],i.$parsers=[p],i.$isEmpty=function(a){return a!==f.ngTrueValue},i.$render=function(){k[0].checked=i.$viewValue};var q=n(d);(q||k[0].defaultChecked)&&((o(q)||k[0].defaultChecked&&k[0].checked)&&i.$setViewValue(!0),i.$render()),e.off("click")}k.on("change",function(a){var b=this.checked;a.stopPropagation(),i&&("radio"!==this.type||b)&&d.$apply(function(){i.$setViewValue(b)}),m.trigger("change",{target:f.name,value:p(b)})})}}}]);var z=a.module("nu.FileChooser",["nu.List","nu.Event"]);z.directive("nuFileChooser",["$compile","listBuffers","nuEvent",function(b,c){var d='<span class="list item" ext="{{ext(item.name || item)}}" ng-click="$erase()">{{item.name || item}}</span>',e='<buffer class="buffer" type="file"><label class="action">Browse<input type="file"></label></buffer>';return{restrict:"AC",require:"nuList",priority:99,link:function(f,g,h,i){var j,k=g[0],l=k.children,m=i.$bufferDefaults.$new(),n=g.hasClass("multiple"),o=a.element(d);0===i.$buffers.length?(j=b(c.compile(q(e),m))(m),i.$buffers.push(j[0])):j=a.element(i.$buffers[0]),i.$itemCompiler=b(o),g.append(i.$buffers).addClass("file"),i.$getItems=function(){return Array.prototype.slice.call(l,0,-1)},n?(o.addClass("erase"),j.find("input").attr("multiple","multiple")):g.addClass("single"),i.$defaults.ext=function(a){if(a){var b=a.split(/\.([\w\d]+)$/i);if(b[1])return b[1].toLowerCase()}};var p=i.$bufferDefaults.$append;i.$bufferDefaults.$append=function(a){n||!n&&0===i.$viewValue.length?p(a):n||i.$bufferDefaults.$update(0,a)}}}}]);var A=a.module("nu.Show",[]);A.directive("nuShow",[function(){var b=function(){return a.element(arguments).toggleClass("active"),arguments[arguments.length-1]};return{template:'<div class="nu show"><a class="navigation right"><div class="arrow right"></div></a><a class="navigation left"><div class="arrow left"></div></a></div>',restrict:"EACM",replace:!0,require:"?ngModel",transclude:!0,link:function(c,d,e,f,g){var h,i,j=[],k=d[0];f&&c.$watchCollection(e.ngModel,function(c){if(a.isArray(c)&&c.length>0){a.forEach(c,function(b,c){h[c]||(h[c]=a.element("<img/>")[0]),h[c]&&h[c].parentNode!==k&&d.append(h[c]),a.element(h[c]).attr("src",b.src||b)});for(var e=c.length;e<h.length;e++)a.element(h[e]).remove();h=d.find("img"),i&&i.parentNode===k||(i=b(h[0]))}else a.element(h).remove()}),g(function(b){a.forEach(b,function(a){a.tagName&&"img"===a.tagName.toLowerCase()&&j.push(a)})}),d.append(j),h=d.find("img"),h&&h.length>0&&(i=b(h[0]));var l=[function(){i=b(i,i.nextSibling||h[0])},function(){i=b(i,"img"===i.previousSibling.tagName.toLowerCase()?i.previousSibling:h[h.length-1])}];a.forEach(d.find("a"),function(b,c){a.element(b).on("click",l[c])})}}}]);var B=a.module("nu.Slider",[]);B.service("_ScrollSize",["$window",function(b){var c,d,e=[],f=a.element('<div style="width:100px;height:100px;overflow:scroll;"><div style="width:200px;height:200px;"></div></div>'),g=function(a,b){var f=a[0],g=b[0];g.offsetWidth>=f.clientWidth&&!a.css("height")&&a.css({maxHeight:g.clientHeight+"px"}),e.push([f,g]),b.css({height:100+c/f.clientHeight*100+"%",width:100+d/f.clientWidth*100+"%"})};a.element(b).on("resize",function(){a.forEach(e,function(a){g.apply(null,a)})}),this.estimate=function(){a.element(b.document.body).append(f),c=f[0].offsetHeight-f[0].clientHeight,d=f[0].offsetWidth-f[0].clientWidth,f.remove()},this.height=function(){return c},this.width=function(){return d},this.hideBars=function(a,b){g(a,b)},this.estimate()}]),B.directive("nuSlider",["_ScrollSize",function(a){var b='<div class="nu slider"><div class="frame" style="overflow:scroll;"></div></div>';return{replace:!0,template:b,restrict:"EACM",transclude:!0,link:function(b,c,d,e,f){var g=c.css("overflow","hidden").find("div");g.append(f()),a.hideBars(c,g)}}}]);var C=a.module("nu.Event",[]);C.service("nuEvent",["$parse",function(a){var b=function(a,b){return function(c){a(b,{$event:c}),b.$digest()}},c=function(c,d){var e=function(c,d,e){e=e||"change click dblclick mousedown mouseup mouseover mouseout mousemove mouseenter mouseleave keydown keyup keypress submit focus blur copy cut paste ",u.call(this),k(d,function(d,f){if(l(f)&&r(f,"nu")){var g=f.substr(2).toLowerCase();-1!==e.indexOf(g+" ")&&this.on(g,b(a(d),c))}},this)};return o(e.prototype,u.prototype),new e(c,d)};return c}]);var D=a.module("nu.Src",[]);D.directive("nuSrc",[function(){return{restrict:"AC",link:function(a,b,c){a.$watch(c.nuSrc,function(a){if(l(a))c.$set("src",a);else if(window.File&&window.FileReader&&a.name&&a.lastModifiedDate){var b=new FileReader;b.readAsDataURL(a),b.onload=function(a){c.$set("src",a.target.result)}}})}}}]);var E=a.module("nu.Wrap",[]),F="ws-view",G="ws-edit";E.run(["$templateCache",function(a){a.put("nu.wrap.default","<div><wrap-view>{{$model$}}</wrap-view><wrap-in></wrap-in></div>")}]);var H=function(a,b){var c=this;a.on("keydown",function(a){var b=a.which||a.keyCode;91===b||b>15&&19>b||b>=37&&40>=b||(c.$toAccept=!0)}),this.$accept=function(){c.$viewValue=a.val(),b.html(c.$viewValue||a.attr("placeholder")),c.$toAccept=!1},this.$reset=function(){a.val(b.html()!==a.attr("placeholder")?b.html():""),c.$toAccept=!1},this.isSimple=!0,this.$valid=!0},I={$template:"nu.wrap.default"},J={$setDirty:j};E.directive("nuWrap",["$templateCache","$parse","$compile","$exceptionHandler","$animate",function(d,e,f,g,h){return{restrict:"AC",require:["?ngModel","^?form","^?wrapset"],priority:10,link:function(j,l,o,p){var q=l[0],r=a.element('<a class="w-view show-view"></a>'),u=p[0]||new H(l,r,x),v=p[1]||J,w=p[2]||I,x=j.$new(!0),y=a.element(d.get(o.nuWrap||w.$template));y.length>1&&(y=a.element("<div></div>").append(y)),y.addClass("nu wrap ws-view"),r.html((y.find("wrap-view").html()||"{{$model$}}").replace("$model$","$viewValue")),y.find("wrap-view").replaceWith(r).length||y.prepend(r);var z=i.append.text(r[0],"");f(y)(x),l.addClass("show-editor w-edit"),q.parentNode.replaceChild(y[0],q),y[0].replaceChild(q,y.find("wrap-in")[0]);var A=function(a){var b=l.attr("placeholder");z.nodeValue=b&&a?b:""};if(u.$toAccept=!1,m(u.$setViewValue)){var B=e(o.ngModel),C=B.assign;x.$valid=u.$valid,x.$error=u.$error,x.$viewValue=u.$viewValue,x.$modelValue=u.$modelValue;var D=t(j,u,B(j),C),E=!1;D&&(D.get=function(a){if(u.$toAccept)return D.last;var b=D.exp(a);return x.$viewValue=u.$viewValue,x.$modelValue=u.$modelValue,A(!u.$viewValue||""===u.$viewValue),b}),u.$setViewValue=function(a){u.$viewValue=a,u.$toAccept=!0,u.$pristine&&(u.$dirty=!0,u.$pristine=!1,h.removeClass(l,b),h.addClass(l,c),v.$setDirty()),k(this.$parsers,function(b){a=b(a)}),x.$viewValue=u.$viewValue,u.$modelValue=x.$modelValue=a,x.$valid=u.$valid},u.$accept=function(){C(j,x.$modelValue),k(u.$viewChangeListeners,function(a){try{a()}catch(b){g(b)}}),u.$toAccept=!1,A(!u.$viewValue||""===u.$viewValue)},u.$reset=function(){u.$toAccept=!1;var a=D.exp(j);a||(u.$viewValue=u.$modelValue=a,l.val("")),x.$viewValue=u.$viewValue,x.$modelValue=u.$modelValue,x.$valid=u.$valid}}A(!l.val()),x.reset=u.$reset,x.accept=u.$accept,x.show=function(a){a!==E&&(u.$toAccept||(x.resetValue=u.$modelValue),y.removeClass(a?F:G).addClass(a?G:F),E=a)};var K=function(a){try{var b=a.which||a.keyCode;13===b||27===b?(a.preventDefault(),13===b&&!u.$valid||27===b?u.$reset():u.$accept(),j.$digest(),x.show(!1)):u.$toAccept||x.show(!0)}catch(c){g(c)}};o.$observe("defaultNav",function(a){l[n(a)||s(a)?"on":"off"]("keydown",K)}),l.on("focus",function(){u.$toAccept||x.show(!0)}),l.on("blur",function(){u.$toAccept||x.show(!1)}),r.on("mousedown",function(){x.show(!0),setTimeout(function(){q.focus()},0)})}}}]),E.filter("asterises",function(){return function(a,b){if(a){for(var c="",d=0;d<a.length;d++)c+=b||"•";return c}return a}}),E.directive("wrapset",[function(){return{restrict:"EAC",controller:["$scope","$element","$attrs",function(a,b,c){this.$template=c.wrapset||c.tmpl}]}}]);a.module("nu",["nu.Switch","nu.PressButton","nu.List","nu.FileChooser","nu.Show","nu.Src","nu.Slider","nu.Wrap"])}(angular);