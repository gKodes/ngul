/*! nu 2014-04-22 */
!function(a){"use strict";var b="ng-pristine",c="ng-dirty",d=/\.([\w\d]+)$/i,e=/([^\\\/]+)$/,f=function(a){var b=["",""];return function(c){if(c){var d=c.split(a);return d?d.splice(0,2):b}return b}},g=f(d),h=f(e),i=function(a){return h(a)[1]},j={},k={},l=a.noop,m=(a.copy,a.equals,a.forEach),n=a.isString,o=(a.isElement,a.isFunction),p=a.isUndefined,q=a.extend,r=a.$$minErr("nu"),s=function(a){return n(a)?a.replace(/^\s+|\s+$/g,""):""},t=function(a,b){return n(a)&&n(b)&&0===a.indexOf(b)},u=function(a){if(a&&n(a)){var b=a.toLowerCase();return!("false"===b||"f"===b||"off"===b)}return!1};k.defaults={pool:"0123456789abcdefghiklmnopqrstuvwxyz",size:8},k.id=function(a){a=q(k.defaults,a);for(var b="",c=0;c<a.size;c++)b+=a.pool[Math.floor(Math.random()*a.pool.length)];return b},j.attribute=function(a,b,c){for(var d=0;d<c.length;d++)a.attr(c[d],b.attr(c[d])),b.removeAttr(c[d]);return a};var v=function(){var a=function(){this.events={}};return a.prototype.on=function(a,b){this.events[a]||(this.events[a]=[]),this.events[a].push(b)},a.prototype.off=function(a){if(this.events[a]){var b=this.events[a].indexOf;if(-1!==b)return this.events[a].split(b,1)[0]}},a.prototype.trigger=function(a,b){return this.events[a]&&m(this.events[a],function(a){a(b)}),b},a}(m),w=a.module("nu.List",[]),x=["$scope","$element","$exceptionHandler","$attrs","$compile","$parse",function(d,e,f,g,h,i){var j=this,k=[],m=e[0],n=m.children,o=parseInt(g.capacity)||10,p=g.nuList||g.src,r=i(p),s=r.assign,t=!1,u=(parseInt(g.min),parseInt(g.max),function(a){return m.insertBefore(a,j.$buffers[0])});this.$dirty=!1,this.$pristine=!0,this.$viewValue=Number.NaN,this.$modelValue=Number.NaN,this.$render=l,this.$name=g.name,this.$buffers=[],this.$defaults=q(d.$new(),{$erase:function(){j.$removeItem(this.item)}}),this.$bufferDefaults=q(d.$new(),{$append:function(a){j.$itemNodeFactory({item:a,$index:j.$viewValue.length}),j.$updateViewValue(j.$viewValue.push(a))},$update:function(b,c){a.element(n[b]).scope().item=c}}),this.$getItems=function(){return Array.prototype.slice.call(n,0)},d.$watchCollection(p,function(b){return b?(t||(j.$viewValue=j.$modelValue=b,k=j.$getItems(),j.$render(),a.element(k.splice(o-1)).remove(),a.element(k).css("display","none")),void(t=!1)):s?void s(d,[]):void(j.$viewValue=[])}),this.$itemCompiler=h('<span class="list item erase" ng-click="$erase(item)">{{item}}</span>'),this.$itemNodeFactory=function(b){var c=a.element(k.shift()||j.$itemCompiler(j.$defaults.$new(),function(a){u(a[0])}));return q(c.scope(),b),c.css("display","")},this.$removeItem=function(b){var c=this.$viewValue.indexOf(b);n.length>c&&(j.$viewValue.splice(c,1),a.element(n[c]).css("display","none"),u(n[c])),j.$updateViewValue()},this.$setDirty=function(){j.$pristine=!1,j.$dirty=!0,e.removeClass(b).addClass(c)},this.$setPristine=function(){j.$pristine=!0,j.$dirty=!1,e.removeClass(c).addClass(b)},this.$updateViewValue=function(){j.$pristine&&j.$setDirty(),s&&(t=!0,s(d,j.$viewValue))}}];w.service("listBuffers",function(){var b={};b.txt=function(a,b){a.attr("contenteditable","true"),a.on("keydown",function(a){var c=a.which||a.keyCode;if(13===c){var d=s(this.innerHTML).replace(/<br\/?>/gi,"");this.innerHTML="",a.preventDefault(),d&&b.$apply(function(a){a.$append(d)})}}).html("")},b.file=function(a,b){var c=a.find("input");c.on("change",function(a){var c=a.target.files;c.length>0&&(a.preventDefault(),b.$apply(function(a){for(var b=0;b<c.length;b++)a.$append(c[b])}),this.value="")})},b.default=l,this.compile=function(c,d){var e=a.element(c.replace(/(<\/?)buffer/gi,"$1span")),f=e.attr("type")||"default";return b[f]||(f="default"),b[f](e,d),e},this.type=function(a,c){return c&&(b[a]=c),b[a]}}),w.directive("nuList",["$compile","$parse","listBuffers",function(b,c,d){return{terminal:!0,priority:99,template:'<div class="nu list"></div>',replace:!0,transclude:"element",restrict:"EACM",controller:x,link:function(c,e,f,g,h){var i=h();i.scope().$destroy();var j=i.find("buffer").remove(),k=s(i.html()),n=e[0].children;if(k&&(t(k,"<")||(k='<span ng-click="$erase(item)">'+k+"</span>"),g.$itemCompiler=b(k)),j.length>0){if(j.find("buffer").length>0)throw r("list","Nested buffers are not allowed");a.forEach(j,function(a){var c=g.$bufferDefaults.$new(),e=b(d.compile(s(a.outerHTML),c))(c).addClass("buffer");g.$buffers.push(e[0])}),e.append(g.$buffers),g.$getItems=function(){return Array.prototype.slice.call(n,0,-j.length)}}var o=function(){g.$removeItem(this.item)};f.$observe("readonly",function(a){g.$defaults.$erase="readonly"===a||"true"===a?l:o,g.$defaults.$erase!==l&&e.attr("readonly","")}),f.$observe("buffer",function(b){var c=a.element(g.$buffers);"false"===b?c.addClass("hidden-buffer"):c.removeClass("hidden-buffer")}),g.$render=function(){m(g.$viewValue,function(a,b){g.$itemNodeFactory({item:a,$index:b})})}}}}]);var y=a.module("nu.PressButton",["nu.Event"]);y.directive("nuPressButton",["nuEvent",function(b){var c='<div class="nu button press"><input class="src" type="checkbox" autocomplete="off" style="display:none;"><label icon="Off"></label><label icon="On"></label></div>';return{template:c,restrict:"EACM",replace:!0,require:"?ngModel",link:function(c,d,e,f){var g=e.id,h=d.find("input"),i=d.find("label"),l=b(c,e);g?d.removeAttr("id"):g=k.id(),j.attribute(h,d,["type","name","checked"]).attr("id",g),i.attr("for",g),e.$observe("iconOn",function(b){a.element(i[0]).attr("class",(e.icon?e.icon:"")+(b?" "+b:""))}),e.$observe("iconOff",function(b){a.element(i[1]).attr("class",(e.icon?e.icon:"")+(b?" "+b:""))}),e.$observe("disabled",function(b){a.isDefined(b)&&"false"!==b?h.attr("disabled",b):h.removeAttr("disabled")});var m=function(b){return a.isDefined(e.value)&&b===e.value||b===!0},n=function(a){return e.value?a?e.value:e.valueOff:a};f&&(f.$formatters.unshift(m),f.$parsers.unshift(n),f.$isEmpty=function(a){return a!==e.value},f.$render=function(){h[0].checked=f.$viewValue},(c[e.ngModel]||h[0].defaultChecked)&&(f.$setViewValue(m(c[e.ngModel])||h[0].defaultChecked&&h[0].checked),f.$render())),h.on("change",function(a){var b=this.checked;a.stopPropagation(),f&&("radio"!==this.type||b)&&c.$apply(function(){f.$setViewValue(b)}),l.trigger("change",{target:e.name,value:n(b)})})}}}]);var z=a.module("nu.Switch",["nu.Event"]);z.directive("nuSwitch",["nuEvent",function(b){var c='<div class="nu switch"><input class="src" type="checkbox" autocomplete="off"><label class="label"></label></div>';return{template:c,restrict:"EACM",replace:!0,require:"?ngModel",link:function(c,d,e,f){var g=e.id,h=d.find("input"),i=d.find("label"),l=b(c,e);g?d.removeAttr("id"):g=k.id(),j.attribute(h,d,["type","name","checked"]).attr("id",g),i.attr("for",g),e.$observe("on",function(a){i.text(a?a:"On")}),e.$observe("off",function(a){i.attr("label-off",a?a:"Off")}),e.$observe("disabled",function(b){a.isDefined(b)&&"false"!==b?h.attr("disabled",b):h.removeAttr("disabled")});var m=function(b){return a.isDefined(e.value)&&b===e.value||b===!0},n=function(a){return e.value?a?e.value:e.valueOff:a};f&&(f.$formatters.push(m),f.$parsers.push(n),f.$isEmpty=function(a){return a!==e.value},f.$render=function(){h[0].checked=f.$viewValue},(c[e.ngModel]||h[0].defaultChecked)&&(f.$setViewValue(m(c[e.ngModel])||h[0].defaultChecked&&h[0].checked),f.$render())),h.on("change",function(a){var b=this.checked;a.stopPropagation(),f&&("radio"!==this.type||b)&&c.$apply(function(){f.$setViewValue(b)}),l.trigger("change",{target:e.name,value:n(b)})})}}}]);var A=a.module("nu.FileChooser",["nu.Event"]);A.directive("nuFileChooser",["nuEvent",function(b){var c='<label class="nu file chooser" style="position: relative;"><input type="file"/><span></span><a class="remove"></a></label>';return{template:c,restrict:"EACM",replace:!0,require:"?ngModel",link:function(c,d,e,f){var h=d.find("input"),j=d.find("span"),k=d.find("a"),l=b(c,e),m=function(a,b,c){d.attr("ext",a),d.attr("mime",b),d.attr("state",c)},n=function(b){if(a.isDefined(b)){var c,d,e;a.isDefined(b.name)?(d=b.type,e=b.name):e=b;var f=g(e);return c=(f.length>1?f[1]:f[0]).toLowerCase(),m(c,d,"selected"),i(e)}return b};f&&(f.$formatters.unshift(n),f.$render=function(){j.html(f.$viewValue)},k.on("click",function(){j.html(""),m("","","","select"),c.$apply(function(){f.$setViewValue(void 0)})})),h.on("change",function(a){var b={target:e.name};if(a.currentTarget.files.length>0){var d=a.currentTarget.files[0];f&&c.$apply(function(){f.$setViewValue(d)}),j.html(n(d)),b.value=a.currentTarget.files}l.trigger("change",b)})}}}]);var B=a.module("nu.Show",[]);B.directive("nuShow",[function(){var b=function(){return a.element(arguments).toggleClass("active"),arguments[arguments.length-1]};return{template:'<div class="nu show"><a class="navigation right"><div class="arrow right"></div></a><a class="navigation left"><div class="arrow left"></div></a></div>',restrict:"EACM",replace:!0,require:"?ngModel",transclude:!0,link:function(c,d,e,f,g){var h,i,j=[],k=d[0];f&&c.$watchCollection(e.ngModel,function(c){if(a.isArray(c)&&c.length>0){a.forEach(c,function(b,c){h[c]||(h[c]=a.element("<img/>")[0]),h[c]&&h[c].parentNode!==k&&d.append(h[c]),a.element(h[c]).attr("src",b.src||b)});for(var e=c.length;e<h.length;e++)a.element(h[e]).remove();h=d.find("img"),i&&i.parentNode===k||(i=b(h[0]))}else a.element(h).remove()}),g(function(b){a.forEach(b,function(a){a.tagName&&"img"===a.tagName.toLowerCase()&&j.push(a)})}),d.append(j),h=d.find("img"),h&&h.length>0&&(i=b(h[0]));var l=[function(){i=b(i,i.nextSibling||h[0])},function(){i=b(i,"img"===i.previousSibling.tagName.toLowerCase()?i.previousSibling:h[h.length-1])}];a.forEach(d.find("a"),function(b,c){a.element(b).on("click",l[c])})}}}]);var C=a.module("nu.Slider",[]);C.service("_ScrollSize",["$window",function(b){var c,d,e=[],f=a.element('<div style="width:100px;height:100px;overflow:scroll;"><div style="width:200px;height:200px;"></div></div>'),g=function(a,b){var f=a[0],g=b[0];g.offsetWidth>=f.clientWidth&&a.css({maxHeight:g.clientHeight+"px"}),e.push([f,g]),b.css({height:100+c/f.clientHeight*100+"%",width:100+d/f.clientWidth*100+"%"})};a.element(b).on("resize",function(){a.forEach(e,function(a){g.apply(null,a)})}),this.estimate=function(){a.element(b.document.body).append(f),c=f[0].offsetHeight-f[0].clientHeight,d=f[0].offsetWidth-f[0].clientWidth,f.remove()},this.height=function(){return c},this.width=function(){return d},this.hideBars=function(a,b){g(a,b)},this.estimate()}]),C.directive("nuSlider",["_ScrollSize",function(a){var b='<div class="nu slider"><div class="frame" style="overflow:scroll;"></div></div>';return{replace:!0,template:b,restrict:"EACM",transclude:!0,link:function(b,c,d,e,f){var g=c.css("overflow","hidden").find("div");f(b,function(b){g.append(b),a.hideBars(c,g)})}}}]);var D=a.module("nu.Event",[]);D.service("nuEvent",["$parse",function(a){var b=function(a,b){return function(c){a(b,{$event:c}),b.$digest()}},c=function(c,d){var e=function(c,d){v.call(this),m(d,function(d,e){n(e)&&t(e,"nu")&&this.on(e.substr(2).toLowerCase(),b(a(d),c))},this)};return q(e.prototype,v.prototype),new e(c,d)};return c}]);var E=a.module("nu.Src",[]);E.directive("nuSrc",[function(){return{restrict:"AC",link:function(a,b,c){a.$watch(c.nuSrc,function(a){if(n(a))c.$set("src",a);else if(window.File&&window.FileReader&&a.name&&a.lastModifiedDate){var b=new FileReader;b.readAsDataURL(a),b.onload=function(a){c.$set("src",a.target.result)}}})}}}]);var F=a.module("nu.Wrap",[]),G="ws-view",H="ws-edit";F.run(["$templateCache",function(a){a.put("nu.wrap.default",'<span class="nu wrap"><wrap-view>{{$model$}}</wrap-view><wrap-in></wrap-in></span>')}]);var I=function(a,b){b.html(a.val()||a.attr("placeholder")),a.on("keyup",function(){b.html(a.val())}),this.$reset=function(){a.val(b.html())},this.isSimple=!0},J={$template:"nu.wrap.default"};F.directive("nuWrap",["$templateCache","$parse","$compile",function(b,c,d){return{restrict:"AC",require:["?ngModel","^?wrapset"],priority:10,link:function(e,f,g,h){var i=f[0],j=h[1]||J,k=a.element('<a class="w-view show-view"></a>'),l=c(g.ngModel),m=l.assign,n=e.$new(!0),q=h[0]||new I(f,k),r=a.element(b.get(g.tmpl||j.$template)).addClass("ws-view"),s=r.find("wrap-view").html()||"{{$model$}}";if(d(r)(n),n.resetValue=l(e),f.addClass("show-editor w-edit"),i.parentNode.replaceChild(r[0],i),r.find("wrap-in").replaceWith(f),r.find("wrap-view").replaceWith(k),o(q.$setViewValue)){k.html(s.replace("$model$",g.ngModel)),d(k)(e),n.valid=q.$valid,n.error=q.$error,n.value=n.validValue=l(e);var t=q.$setViewValue,v=q.$render;q.$render=function(){n.show(!1),v.call(q)},q.$setViewValue=function(a){n.value=a,t.call(q,a),n.valid=q.$valid,n.validValue=q.$modelValue},q.$reset=function(){m(e,n.resetValue)}}n.reset=q.$reset,n.show=function(a){r.removeClass(a?G:H).addClass(a?H:G)};var w=function(a){var b=a.which||a.keyCode;(13===b||27===b)&&((13===b&&!q.$valid||27===b)&&q.$reset(),n.show(!1),e.$digest(),setTimeout(function(){i.blur()},0))};g.$observe("defaultNav",function(a){f[p(a)||u(a)?"on":"off"]("keyup",w)}),k.on("mousedown",function(){n.resetValue=l(e)||n.resetValue,n.show(!0),setTimeout(function(){i.focus()},0)})}}}]),F.directive("wrapset",[function(){return{restrict:"EAC",controller:["$scope","$element","$attrs",function(a,b,c){this.$template=c.wrapset||c.tmpl}]}}]);a.module("nu",["nu.Switch","nu.PressButton","nu.List","nu.FileChooser","nu.Show","nu.Src","nu.Slider","nu.Event","nu.Wrap"])}(angular);